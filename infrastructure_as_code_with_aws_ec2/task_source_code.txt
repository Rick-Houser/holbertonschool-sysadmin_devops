

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="Holberton School">
    <link rel="icon" href="../../favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <title>Holberton School's awesome intranet</title>

	<link rel="stylesheet" media="all" href="/assets/application-83cd9391963b51070de4fa8f4e738a2f285c3a0f76bf07dcc28e2fb79a8dc727.css" />
	<script src="/assets/application-757cfc2fe8774b69f1d9fb575e2e38dac54dfefe06b930b2aaf71187497104a4.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.ico" />
	<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="6jYyHQ9ZkuN4r1f4dKf8vF9ngxCvvleALm/lcAh4F3vpklG85p+rIv3yWtF2dnMjUad1XqItU8HZLVTAvJljmg==" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body class="signed_in">

      <nav id="nav-left" class="hidden-xs title-font">
        <a href="/">
          <div id="holberton-logo">
            <img alt="Holberton School" src="/assets/holberton-logo-simplified-d4e8a1e8bf5ad93c8c3ce32895b4b53749b477b7ba7342d7f064e6883bcd3be2.png" />
          </div>
</a>        <ul>
            <li>
    <a href="/dashboards/my_planning">
        <div class="icon">
          <i class="fa fa-calendar"></i>
        </div>
      My planning
</a>  </li>
  <li>
    <a href="/dashboards/my_current_projects">
        <div class="icon">
          <i class="fa fa-list"></i>
        </div>
      My projects
</a>  </li>
  <li>
    <a href="/dashboards/my_concepts">
        <div class="icon">
          <i class="fa fa-file-text"></i>
        </div>
      My concepts
</a>  </li>
  <li>
    <a href="/dashboards/my_batchmates">
        <div class="icon">
          <i class="fa fa-users"></i>
        </div>
      My batchmates
</a>  </li>
  <li>
    <a href="/dashboards/corrections_i_can_make">
        <div class="icon">
          <i class="fa fa-check"></i>
        </div>
      QA reviews I can make
</a>  </li>
  <li>
    <a href="/dashboards/my_captain_log">
        <div class="icon">
          <i class="fa fa-book"></i>
        </div>
      My Captain's Logs
</a>  </li>
  <li>
    <a href="/dashboards/my_server">
        <div class="icon">
          <i class="fa fa-server"></i>
        </div>
      My Servers
</a>  </li>
  <li>
    <a href="/dashboards/my_technical_interviews">
        <div class="icon">
          <i class="fa fa-comments"></i>
        </div>
      My technical interviews
</a>  </li>

<li>
  <a href="/users/my_profile">
      <div class="icon">
        <i class="fa fa-user"></i>
      </div>
    My profile
</a></li>

        </ul>
      </nav>

    <main>

        <nav class="navbar navbar-default navbar-main visible-xs">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/">
                  <img alt="Holberton School" src="/assets/holberton-logo-simplified-d4e8a1e8bf5ad93c8c3ce32895b4b53749b477b7ba7342d7f064e6883bcd3be2.png" />
</a>            </div>
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                  <li>
    <a href="/dashboards/my_planning">
      My planning
</a>  </li>
  <li>
    <a href="/dashboards/my_current_projects">
      My projects
</a>  </li>
  <li>
    <a href="/dashboards/my_concepts">
      My concepts
</a>  </li>
  <li>
    <a href="/dashboards/my_batchmates">
      My batchmates
</a>  </li>
  <li>
    <a href="/dashboards/corrections_i_can_make">
      QA reviews I can make
</a>  </li>
  <li>
    <a href="/dashboards/my_captain_log">
      My Captain's Logs
</a>  </li>
  <li>
    <a href="/dashboards/my_server">
      My Servers
</a>  </li>
  <li>
    <a href="/dashboards/my_technical_interviews">
      My technical interviews
</a>  </li>

<li>
  <a href="/users/my_profile">
    My profile
</a></li>

              </ul>

              <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Rick Houser <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><a rel="nofollow" data-method="delete" href="/auth/sign_out">Log out</a></li>
                  </ul>
                </li>
              </ul>

            </div><!--/.nav-collapse -->
          </div>
        </nav>


        <div id="captains_log_alert">
          <a href="/captain_logs/722/edit">
            <div class="container">
              <p>
                You have a captain's log due before 2016-08-14 (in 2 days)! Log it now!
              </p>
            </div>
</a>        </div>

      <article class="pending_logs">
          <div class="alert alert-info sm-gap">You just released the optional tasks of this project. Have fun!</div>


<h1 class="gap">Infrastructure as code with AWS EC2</h1>

<div id="project_id" style="display: none" data-project-id="187"></div>

<p class="sm-gap">
  <small>
    <i class="fa fa-folder-open"></i>
    Sysadmin &amp; Devops â€• CI/CD
  </small>
</p>

  <p>
    <em>
      <small>
        <i class="fa fa-user"></i> by Sylvain Kalache
      </small>
    </em>
  </p>


  <p>
    <small>
      <i class="fa fa-calendar"></i>
        Project over - took place from 07-27-2016 to 08-09-2016
        - <span id="student_task_done_percentage">you're 0</span>% done.
    </small>
  </p>

  <p>
    <small>
      <i class="fa fa-check-square"></i>
      QA review fully automated.
    </small>
  </p>




<article id="description" class="gap formatted-content">
  <p>The first Web <a href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a>s appeared in 2000 and they are now everywhere. They even gave birth to an entire set of services that rely solely and selling their services via APIs. They allow people to access a service from the outside via a set of defined methods and protocols so that one can integrate this service into another one.</p>

<p>In the infrastructure world, the Cloud has big API components which allow it to drive server and network infrastructures with code. The most successful Cloud computing company is <strong>Amazon Web Services</strong> (<code>AWS</code>) which provides many on-demand products via APIs (and web interface of course).</p>

<p>Ressources:</p>

<ul>
<li><a href="https://youtu.be/TsRBftzZsQo">Introduction video to AWS EC2</a></li>
<li>Vocabulary:

<ul>
<li><strong>Instance</strong>: synonym for server</li>
<li><strong>Security group</strong>: is a set of firewall rules that you can attach to one or more servers</li>
<li><strong>AMI</strong>: image for a server (Ubuntu, CentOS, FreeBDS, Ubuntu + packages...)</li>
<li><strong>IAM</strong>: Identity and Access Management, where you can manage AWS users and groups</li>
<li><strong>Instance type</strong>: type of hardware for an instance</li>
<li><strong>VPC</strong>: Amazon Virtual Private Cloud, private network within EC2</li>
<li>Different types of IP:

<ul>
<li><strong>Private IP</strong>: instance private IP within the VPC</li>
<li><strong>Public IP</strong>: instance IPv4 public IP (accessible on the internet)</li>
<li><strong>Public DNS</strong>: instance DNS entry pointing to the IPv4 public IP (preferred way of reaching your server if reaching from outside of a VPC)</li>
</ul></li>
</ul></li>
</ul>

</article>

  <hr class="gap">
  <h2 class="gap">Tasks</h2>
  <section  class="formatted-content">
        <div data-role="task660" data-move-url="https://intranet.hbtn.io/tasks/660/move" data-position="1">
            <div class=" clearfix gap" id="task-660">

    <div class="student_task_controls">
      <button class="student_task_done btn btn-default no" data-task-id="660">
        <span class="no"><i class="fa fa-square-o"></i></span>
        <span class="yes"><i class="fa fa-check-square-o"></i></span>
        <span class="pending"><i class="fa fa-spinner fa-pulse"></i></span>
        Done<span class="no pending">?</span><span class="yes">!</span>
      </button>
        <br>

      <button class="users_done_for_task btn btn-default btn-sm" data-task-id="660" data-toggle="modal" data-target="#task-660-users-done-modal">
        Who is done?
      </button>
      <br>
      <div class="modal fade users-done-modal" id="task-660-users-done-modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">Batchmates who are done with "Manage EC2 instances"</h4>
            </div>
            <div class="modal-body">
              <div class="list-group">
              </div>
                  <a class="btn btn-default btn-sm student_task_help" data-confirm="Are you sure you wish to notify people?" href="/tasks/660/mark_as_help">Help!</a>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->


          <button class="student_task_help btn btn-default btn-sm" data-task-id="660" >
            Help!
          </button>

    </div>

  <h4 class="task">
    0. Manage EC2 instances
    <span class="alert alert-warning mandatory-optional">
      mandatory
    </span>
  </h4>



  <p>One great thing about Cloud services is that they often expose APIs to interact with resources so that you can do infrastructure as code. The goal of this exercise will be to perform basic operations such as creating, stopping, starting, and terminating an AWS server via a Ruby script.</p>

<p>Requirements:</p>

<ul>
<li>Your script must be written in <strong>Ruby</strong></li>
<li>Your script must accept the current parameters:

<ul>
<li><strong>-a</strong>, <strong>--action</strong> [launch, stop, start, terminate]:</li>
<li><code>launch</code>:

<ul>
<li>Creates a new server</li>
<li>Parameter: none</li>
<li>Returns: <code>instance_id</code>, public<em>dns</em>name`, when server is ready (string)</li>
</ul></li>
<li><code>stop</code>:

<ul>
<li>Stops a server</li>
<li>Parameter: <code>instance_id</code></li>
<li>Returns: nothing, when the server is stopped</li>
</ul></li>
<li><code>start</code>:

<ul>
<li>Starts a server</li>
<li>Parameter: <code>instance_id</code></li>
<li>Returns: <code>public_dns_name</code>, when the server is started (string)</li>
</ul></li>
<li><code>terminate</code>:

<ul>
<li>Terminates a server</li>
<li>Parameter:<code>instance_id</code></li>
<li>Returns: nothing, when the server is terminated</li>
</ul></li>
<li><strong>-i</strong>, <strong>--instance_id</strong>, provides the server id when required</li>
<li><strong>-v</strong>, <strong>--verbose</strong>, provides extra information while the script is running</li>
<li><strong>-h</strong>, <strong>--help</strong>, returns the help menu</li>
</ul></li>
<li>You must provide a <code>Gemfile</code> containing all gems that you are using (that <a href="http://bundler.io/">Bundler</a> will use)</li>
<li>Your script must load its credential from a <a href="http://www.yaml.org/start.html">YAML</a> file named <code>config.yaml</code> with these keys:

<ul>
<li><code>access_key_id</code>: AWS access key ID</li>
<li><code>secret_access_key</code>: AWS secret access key</li>
<li><code>key_pair</code>: Name of SSH key pair to use <em>(available on AWS)</em></li>
<li><code>image_id</code>: ID of the AMI for the created server</li>
<li><code>instance_type</code>: Type of hardware for the created server</li>
<li><code>availability-zone</code>: Availability zone for the created server</li>
<li><code>security_group_ids</code>: Security group for the created server</li>
</ul></li>
<li>Do not provide your <code>config.yaml</code> file in github, we will use our own</li>
</ul>

<p>Example:</p>

<pre><code>Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=launch
i-5ca3f5da,ec2-54-164-184-53.compute-1.amazonaws.com
Sylvains-iMac:187 sylvainkalache$ ping ec2-54-164-184-53.compute-1.amazonaws.com
PING ec2-54-164-184-53.compute-1.amazonaws.com (54.164.184.53): 56 data bytes
64 bytes from 54.164.184.53: icmp_seq=0 ttl=38 time=75.486 ms
64 bytes from 54.164.184.53: icmp_seq=1 ttl=38 time=74.553 ms
64 bytes from 54.164.184.53: icmp_seq=2 ttl=38 time=74.408 ms
64 bytes from 54.164.184.53: icmp_seq=3 ttl=38 time=74.721 ms
64 bytes from 54.164.184.53: icmp_seq=4 ttl=38 time=74.104 ms
^C
--- ec2-54-164-184-53.compute-1.amazonaws.com ping statistics ---
5 packets transmitted, 5 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 74.104/74.654/75.486/0.463 ms
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=stop --instance_id=i-5ca3f5da
$ ping ec2-54-164-184-53.compute-1.amazonaws.com
PING ec2-54-164-184-53.compute-1.amazonaws.com (54.164.184.53): 56 data bytes
Request timeout for icmp_seq 0
Request timeout for icmp_seq 1
Request timeout for icmp_seq 2
Request timeout for icmp_seq 3
^C
--- ec2-54-164-184-53.compute-1.amazonaws.com ping statistics ---
5 packets transmitted, 0 packets received, 100.0% packet loss
Sylvains-iMac:187 sylvainkalache$
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=start --instance_id=i-5ca3f5da
ec2-52-90-23-155.compute-1.amazonaws.com
Sylvains-iMac:187 sylvainkalache$ ping ec2-52-90-23-155.compute-1.amazonaws.com
PING ec2-52-90-23-155.compute-1.amazonaws.com (52.90.23.155): 56 data bytes
64 bytes from 52.90.23.155: icmp_seq=0 ttl=38 time=73.520 ms
64 bytes from 52.90.23.155: icmp_seq=1 ttl=38 time=72.804 ms
64 bytes from 52.90.23.155: icmp_seq=2 ttl=38 time=77.542 ms
^C
--- ec2-52-90-23-155.compute-1.amazonaws.com ping statistics ---
3 packets transmitted, 3 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 72.804/74.622/77.542/2.085 ms
Sylvains-iMac:187 sylvainkalache$

</code></pre>

<p>Explanations:</p>

<ul>
<li>I <code>create</code> a new server using the <code>launch</code> action</li>
<li>The script returns the <code>instance_id</code> and <code>public_dns_name</code> when the server is in a running state</li>
<li>I <code>ping</code> the server and it responds</li>
<li>I <code>stop</code> the server</li>
<li>The script returns nothing when the server is stopped</li>
<li>I <code>ping</code> the server and it does not respond</li>
<li>I <code>start</code> the server back</li>
<li>The script returns the <code>public_dns_name</code> <em>(notice that it changed)</em> when the server is in a running state</li>
<li>I <code>ping</code> the server and it responds</li>
</ul>

<p>Tips:</p>

<ul>
<li>gem <code>optparse</code></li>
<li>gem <code>aws-sdk</code></li>
<li>gem <code>yaml</code></li>
<li><a href="https://gist.github.com/sylvainkalache/cba78159713fd2c2ac4d071fb63c1b09">Gist Yaml for Ruby</a></li>
<li><a href="https://www.youtube.com/watch?v=B7busB5OfEA">Video load a Yaml file with Ruby</a></li>
</ul>

<p>Note that you can also interact with your servers via the web interface:</p>

<p><img src="http://i.imgur.com/oZ7NuUz.png" alt="AWS EC2 dashboard screenshot"></p>


    <p class="sm-gap"><strong>Repo:</strong></p>
    <ul>
      <li>GitHub repository: <code>holbertonschool-sysadmin_devops</code></li>
        <li>Directory: <code>infrastructure_as_code_with_aws_ec2</code></li>
        <li>File: <code>0-manage_ec2_instances.rb</code></li>
    </ul>
</div>

        </div>
        <div data-role="task661" data-move-url="https://intranet.hbtn.io/tasks/661/move" data-position="2">
            <div class=" clearfix gap" id="task-661">

    <div class="student_task_controls">
      <button class="student_task_done btn btn-default no" data-task-id="661">
        <span class="no"><i class="fa fa-square-o"></i></span>
        <span class="yes"><i class="fa fa-check-square-o"></i></span>
        <span class="pending"><i class="fa fa-spinner fa-pulse"></i></span>
        Done<span class="no pending">?</span><span class="yes">!</span>
      </button>
        <br>

      <button class="users_done_for_task btn btn-default btn-sm" data-task-id="661" data-toggle="modal" data-target="#task-661-users-done-modal">
        Who is done?
      </button>
      <br>
      <div class="modal fade users-done-modal" id="task-661-users-done-modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">Batchmates who are done with "Add more parameter options"</h4>
            </div>
            <div class="modal-body">
              <div class="list-group">
              </div>
                  <a class="btn btn-default btn-sm student_task_help" data-confirm="Are you sure you wish to notify people?" href="/tasks/661/mark_as_help">Help!</a>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->


          <button class="student_task_help btn btn-default btn-sm" data-task-id="661" >
            Help!
          </button>

    </div>

  <h4 class="task">
    1. Add more parameter options
    <span class="alert alert-info mandatory-optional">
      #forfun
    </span>
  </h4>



  <p>Let&#39;s polish your script with some add-ons.</p>

<p>Requirements:</p>

<ul>
<li>Your script must accept the current parameters:

<ul>
<li><strong>-a</strong>, <strong>--action</strong> [launch, stop, start, terminate]:

<ul>
<li><code>status</code>:

<ul>
<li>Return: the status of the instance (and only that, remember that a machine will verify your script, do not add extra information)</li>
<li>Parameter: none</li>
</ul></li>
<li><code>change_name</code>

<ul>
<li>Change the name of an instance</li>
<li>Parameter: <code>instance_id</code></li>
<li>Return: nothing</li>
</ul></li>
</ul></li>
<li>No parameter passed

<ul>
<li>Return: the help menu</li>
</ul></li>
</ul></li>
</ul>

<p>Example:</p>

<pre><code>Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb
Usage: aws_script.rb [options]
    -v, --verbose                    Run verbosely
    -a, --action=ACTION              Select action to perform [launch, start, stop, terminate]
    -i, --instance_id=INSTANCE_ID    ID of the instance to perform an action on
    -n, --name=INSTANCE_NAME         Change the name of the instance
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=status --instance_id=i-5ca3f5da
stopped
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=start --instance_id=i-5ca3f5da
ec2-54-224-98-96.compute-1.amazonaws.com
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb --action=status --instance_id=i-5ca3f5da
running
Sylvains-iMac:187 sylvainkalache$
Sylvains-iMac:187 sylvainkalache$ ./aws_script.rb -nFOO --action=change_name --instance_id=i-5ca3f5da
Sylvains-iMac:187 sylvainkalache$
</code></pre>


    <p class="sm-gap"><strong>Repo:</strong></p>
    <ul>
      <li>GitHub repository: <code>holbertonschool-sysadmin_devops</code></li>
        <li>Directory: <code>infrastructure_as_code_with_aws_ec2</code></li>
        <li>File: <code>1-manage_ec2_instances_plus_plus.rb</code></li>
    </ul>
</div>

        </div>
  </section>






      </article>

    </main>







      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-67152800-6', 'auto');
        ga('send', 'pageview');
      </script>

  </body>
</html>
